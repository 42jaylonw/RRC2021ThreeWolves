#!/usr/bin/python3

import json
import os.path
import sys
from three_wolves.move_cube_env import RLPositionHistoryEnv
from stable_baselines3 import SAC
# from subprocess import check_output
import subprocess

def main():
    # the goal is passed as JSON string
    # goal_json = sys.argv[1]
    # goal_trajectory = json.loads(goal_json)

    env = RLPositionHistoryEnv(goal_trajectory=None,
                               visualization=False)

    print(os.listdir())
    # print(os.listdir('../../userhome/three_wolves'))
    # log_dir = f"../../userhome/three_wolves/model_save/triangle_cube_tg/best_model.zip"
    # log_dir = "three_wolves/model_save/triangle_cube_tg/best_model.zip"
    # cmd = '!git clone https://github.com/42jaylonw/trifinger_model.git'
    # check_output(cmd, shell=True).decode()
    # process = subprocess.Popen(['git', 'clone', 'https://github.com/42jaylonw/trifinger_model.git'])
    process = subprocess.Popen(['git', 'clone', 'https://github.com/42jaylonw/trifinger_model.git'],
                               stdout=subprocess.PIPE,
                               stderr=subprocess.PIPE)
    stdout, stderr = process.communicate()

    log_dir = "trifinger_model/triangle_cube_tg/best_model.zip"
    policy = SAC.load(log_dir)

    observation = env.reset()
    t = 0
    is_done = False
    while not is_done:
        action = policy.predict(observation)[0]
        observation, reward, is_done, info = env.step(action)
        t = info["time_index"]
        print("reward:", reward)


if __name__ == "__main__":
    main()
